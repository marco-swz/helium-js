import{h as e,a as t}from"./utils-RA_86-hs.js";import"./popover-BtSr2gHM.js";const i=new CSSStyleSheet;i.replaceSync(':host {\n    --he-select-backgroundColor: whitesmoke;\n    --he-select-borderColor: lightgrey;\n    --he-select-borderWidth: 1px;\n    --he-select-borderRadius: 3px;\n    --he-select-hover-borderColor: grey;\n    --he-select-color: black;\n    --he-select-padding: 0.3rem 0.4rem;\n    --he-select-popover-borderRadius: 4px;\n    --he-select-popover-maxHeight: 300px;\n    --he-select-popover-maxWidth: 300px;\n    /*--he-select-popover-width: fit-content;*/\n    --he-select-popover-backgroundColor: white;\n    --he-select-option-hover-backgroundColor: whitesmoke;\n    --he-select-option-selected-backgroundColor: whitesmoke;\n    --he-select-after-margin: auto 4px auto auto;\n    --he-select-after-content: "â–¼";\n    --he-select-after-fontSize: 10px;\n    --he-select-after-display: block;\n    --he-select-after-padding: 0px 2px 0px 5px;\n    --he-select-disabled-color: hsl(from var(--he-select-color) h s calc(l + 50));\n    --he-select-before-color: black;\n    --he-select-before-content: \'\';\n    --he-select-before-fontFamily: \'Font Awesome 5 Pro\';\n    --he-select-before-display: \'none\';\n    --he-select-before-fontSize: 10px;\n    --he-select-before-padding: 0;\n\n    height: 1.6rem;\n    font-size: 14px;\n    min-width: 150px;\n    width: 150px;\n    display: inline-block;\n}\n\n:host([disabled]), \n:host([disabled])::slotted([slot=button]) {\n    pointer-events: none;\n    color: var(--he-select-disabled-color);\n}\n\n:host([variant="underline"]) {\n    & #inp {\n        border-top: 0;\n        border-left: 0;\n        border-right: 0;\n        border-radius: 0;\n    }\n}\n\n:host([empty]) {\n    cursor: default;\n    pointer-events: none;\n}\n\n#cont-button {\n    height: inherit;\n    width: inherit;\n    display: flex;\n    align-items: center;\n    background-color: var(--he-select-backgroundColor);\n    border-width: var(--he-select-borderWidth);\n    border-radius: var(--he-select-borderRadius);\n    border-color: var(--he-select-borderColor);\n    border-style: solid;\n    padding: 0;\n\n    &::before {\n        content: var(--he-select-before-content);\n        color: var(--he-select-before-color);\n        font-family: var(--he-select-before-fontFamily);\n        font-size: var(--he-select-before-fontSize);\n        display: var(--he-select-before-display);\n        padding: var(--he-select-before-padding);\n    }\n\n    &::after {\n        content: var(--he-select-after-content);\n        font-size: var(--he-select-after-fontSize);\n        display: var(--he-select-after-display);\n        margin: var(--he-select-after-margin);\n        padding: var(--he-select-after-padding);\n    }\n}\n\n#inp {\n    position: relative;\n    font-size: inherit;\n    border-radius: var(--he-select-borderRadius);\n    width: 100%;\n    height: inherit;\n    min-width: inherit;\n    outline: none;\n    text-align: left;\n    padding: var(--he-select-padding);\n    background-color: var(--he-select-backgroundColor);\n    text-wrap: nowrap;\n    border: 0;\n    color: inherit;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    align-items: center;\n}\n\n#inp:hover {\n    transition:\n        border-color 0.2s;\n    cursor: pointer;\n    border-color: var(--he-select-hover-borderColor);\n}\n\n#popover-content {\n    width: min-content;\n    border-radius: var(--he-select-popover-borderRadius);\n}\n\n#cont-options {\n    display: flex;\n    flex-direction: column;\n    background-color: var(--he-select-popover-backgroundColor);\n    max-height: var(--he-select-popover-maxHeight);\n    width: var(--he-select-popover-width);\n    overflow: auto;\n    overscroll-behavior: contain;\n    user-select: none;\n}\n\nslot[name=option] {\n    display: inline-flex;\n    flex-direction: column;\n}\n\nslot[name=button] {\n    display: flex;\n    align-items: center;\n    height: 100%;\n}\n\n#cont-options option,\n::slotted(*) {\n    padding: 5px 10px;\n    border-radius: 3px;\n    text-align: left;\n    width: 100%;\n    width: -moz-available;          /* WebKit-based browsers will ignore this. */\n    width: -webkit-fill-available;  /* Mozilla-based browsers will ignore this. */\n    width: fill-available;\n    display: inline-block;\n    align-items: center;\n    text-overflow: ellipsis;\n    overflow: hidden;\n}\n\n#cont-options option[selected]::before,\n::slotted([slot=option][selected])::before {\n    font-family: "Font Awesome 5 Pro";\n    content: "\\f00c";\n    font-weight: 600;\n    margin-right: 6px;\n    color: steelblue;\n}\n\n#cont-options:not(:hover) option[highlighted],\n#cont-options:not(:hover) ::slotted([slot=option][highlighted]) {\n    background-color: var(--he-select-option-selected-backgroundColor);\n}\n\n#cont-options option:hover:not(:disabled),\n::slotted([slot=option]:hover:not(:disabled))\n{\n    background-color: var(--he-select-option-hover-backgroundColor);\n    cursor: pointer;\n}\n\n#filter {\n    width: 100%;\n    width: -moz-available;          /* WebKit-based browsers will ignore this. */\n    width: -webkit-fill-available;  /* Mozilla-based browsers will ignore this. */\n    width: fill-available;\n    margin: 3px;\n}\n\n:host([filter="inline"]) {\n    & #filter {\n        --he-input-padding: 0;\n        padding: var(--he-select-padding);\n        border: 0;\n        font-size: inherit;\n        width: 100%;\n        margin: 0;\n        min-width: inherit;\n        border-radius: var(--he-select-borderRadius);\n        background-color: var(--he-select-backgroundColor);\n        outline: none;\n        text-align: left;\n        text-wrap: nowrap;\n        color: inherit;\n    }\n}\n\n:host([multiple]) {\n    & #cont-button {\n        & #inp {\n            display: flex;\n            gap: 3px;\n\n            & span:not(.placeholder) {\n                display: inline-table;\n                align-items: center;\n                border: 1px solid lightgrey;\n                border-radius: 5px;\n                padding: 2px 5px;\n                background-color: white;\n                overflow: hidden;\n                width: fit-content;\n                text-overflow: ellipsis;\n            }\n\n            & span.placeholder {\n                color: grey;\n            }\n        }\n    }\n}\n\n');class n extends HTMLElement{static formAssociated=!0;static observedAttributes=["open","filter","disabled","placeholder"];$popover;$popoverContent;$filter;$options;selections;$button;$contButton;internals;onfilterelement=this._onFilterelementDefault;_filterTimeout=0;_handleClickDocument;constructor(){super(),this.selections=new Set;let e=this.attachShadow({mode:"open"});this.internals=this.attachInternals(),this.$contButton=document.createElement("div"),this.$contButton.id="cont-button",e.append(this.$contButton),this.$popover=document.createElement("he-popover"),this.$popover.id="popover",this.$popover.dismiss="manual",this.$popover.$anchor=this.$contButton,this.$popoverContent=document.createElement("div"),this.$popoverContent.id="popover-content",this.$popoverContent.slot="content",this.$popover.append(this.$popoverContent),this.$filter=document.createElement("he-input"),this.$filter.id="filter",this.$filter.style.display="none",this.$filter.oninput=e=>this._handleChangeFilter.bind(this)(e),this.$button=document.createElement("button"),this.$button.id="inp",this.$button.onclick=()=>{this.open=!0},this.$contButton.append(this.$button),this.$options=document.createElement("div"),this.$options.id="cont-options",this.$popoverContent.append(this.$options),this.onkeydown=e=>this._handleKeydown(e),e.append(this.$popover),e.adoptedStyleSheets=[i]}set disabled(e){e?this.setAttribute("disabled",!0):this.removeAttribute("disabled")}get disabled(){return null!==this.getAttribute("disabled")}set filter(e){e?this.setAttribute("filter",!0):this.removeAttribute("filter")}get filter(){return null!==this.getAttribute("filter")}set name(e){e?this.setAttribute("name",e):this.removeAttribute("name")}get name(){return this.getAttribute("name")}set open(e){e?this.setAttribute("open",""):this.removeAttribute("open")}get open(){return null!==this.getAttribute("open")}set placeholder(e){e?this.setAttribute("placeholder",e):this.removeAttribute("placeholder")}get placeholder(){return this.getAttribute("placeholder")}set value(e){if(null!=e){if(Array.isArray(e)){if(null==this.getAttribute("multiple"))throw new Error("Multiple values are not allowed unless the select has the attribute `multiple`")}else e=[e];this._clearSelections(!1,!1);for(const t of this.getOptions())e.includes(t.getAttribute("value"))&&this._addSelection(t,!1,!1);this._setButtonText(this.selections),this._updateFormValue()}}get value(){let e=[];switch(this.selections.forEach((t=>e.push(t.value??t.getAttribute("value")))),e.length){case 0:return"";case 1:return e[0]}return e}addOption(e,t,i=null){let n=document.createElement("option");n.value=t,n.innerHTML=e;let o=this;if(this.hasAttribute("slotted")?n.slot="option":(o=this.$options,n.onclick=e=>this._handleClickOption.bind(this)(e)),null==i)return o.append(n),n;for(const e of o.children)if(i(e,n))return o.insertBefore(n,e),n}attributeChangedCallback(e,t,i){switch(e){case"open":null!=i?this._showPopover():this._hidePopover();break;case"filter":this.$filter.style.display=null==i||"false"===i?"none":"";break;case"disabled":null!=i?this.internals.setFormValue(null):this.internals.setFormValue(this.value)}}checkValidity(){return!0}connectedCallback(){if("inline"===this.getAttribute("filter"))this.$contButton.append(this.$filter),this.$filter.style.display="none";else this.$popoverContent.prepend(this.$filter);if(this.hasAttribute("slotted")){let e=document.createElement("slot");e.name="option",e.addEventListener("slotchange",(e=>this._handleSlotchange(e))),this.$options.append(e),e=document.createElement("slot"),e.name="button",this.$button.append(e)}else{let e=!0;for(let t of this.querySelectorAll("option"))t.onclick=e=>this._handleClickOption.bind(this)(e),this.$options.append(t),e=!1;e?this.setAttribute("empty",""):this.removeAttribute("empty")}0!==this.selections.size||this.hasAttribute("multiple")?this._setButtonText(this.selections):this.select(0),this.hasAttribute("open")&&(this.open=!0)}formResetCallback(){this._clearSelections()}getOptions(){return Array.from(this.hasAttribute("slotted")?this.$options.children[0].assignedNodes():this.$options.children)}hideOptions(e=null){for(let t of this.getOptions())null==e||e.includes(t.value)?(t.style.display="none",this._removeSelection(t,!1,!1)):t.style.display="";return this._setButtonText(this.selections),this._updateFormValue(),this}nextOption(e=!1){this._moveOption(e,1)}prevOption(e=!1){this._moveOption(e,-1)}removeOption(e){for(const t of this.getOptions())if(t.getAttribute("value")===e)return this._removeSelection(t),void t.remove();throw new Error("No option found with the provided value: "+e)}replaceOption(e,t=null,i=null){let n=this.getOptions().filter((t=>t.getAttribute("value")===e))[0];if(null==n)throw new Error("No option found with the provided value: "+e);null!=i&&n.setAttribute("value",i),null!=t&&(n.innerHTML=t),this.selections.has(n)&&(this._setButtonText(this.selections),this._updateFormValue())}replaceOptions(e,t=null){this.hasAttribute("slotted")?this.innerHTML="":this.$options.innerHTML="",t=t??{},this._clearSelections();for(const i of e)this.addOption(t[i]??i,i);return this.hasAttribute("multiple")||this.select(0),0===Object.size(e)?this.setAttribute("empty",""):this.removeAttribute("empty"),this}reset(){this.formResetCallback()}showOptions(e=null){for(let t of this.getOptions())(null==e||e.includes(t.value))&&(t.style.display="");return this}select(e){let t=this.getOptions();if(0===t.length&&0===e)return;const i=t[e];if(null==i)throw new Error(`No option with the given index ${e}!`);this._addSelection(i),this.dispatchEvent(new CustomEvent("change"))}toggle(){return this.$popover.togglePopover(),this}_handleChangeFilter(){window.clearTimeout(this._filterTimeout),this._filterTimeout=setTimeout((()=>{let e=this.$filter.value,t=this.getOptions();for(const i of t)this.onfilterelement(e,i)?i.style.display="":i.style.display="none"}),250)}_onFilterelementDefault(e,t){e.toLowerCase();let i=t.value??t.getAttribute("value");return 0===e.length||""!==i&&t.innerText.toLowerCase().includes(e)}_handleClickOption(e){const t=e.currentTarget;this.hasAttribute("multiple")?this.selections.has(t)?this._removeSelection(t):this._addSelection(t):(this.open=!1,this._addSelection(t)),this.dispatchEvent(new CustomEvent("change"))}_clearSelections(e=!0,t=!0){this.hasAttribute("multiple")?0!==this.selections.size&&(this.selections.forEach((e=>e.removeAttribute("selected"))),this.selections.clear(),e&&this._setButtonText(this.selections),t&&this._updateFormValue()):this.select(0)}_addSelection(e,t=!0,i=!0){this.selections.has(e)||(this.hasAttribute("multiple")||(this.selections.forEach((e=>e.removeAttribute("selected"))),this.selections.clear()),this.selections.add(e),e.setAttribute("selected",""),t&&this._setButtonText(this.selections),i&&this._updateFormValue())}_removeSelection(e,t=!0,i=!0){this.selections.has(e)&&(this.selections.delete(e),e.removeAttribute("selected"),t&&this._setButtonText(this.selections),i&&this._updateFormValue())}_handleKeydown(e){switch(e.key){case"ArrowDown":e.preventDefault(),this.nextOption(!0);break;case"ArrowUp":e.preventDefault(),this.prevOption(!0);break;case"Enter":if(this.open){e.preventDefault();let t=this.$highlight??this.getOptions()[0],i=this.$filter.value;if(null!=this.getAttribute("create")&&""!==i&&null==this.$highlight){t=this.addOption(i,i,((e,t)=>t.innerText.localeCompare(e.innerText)<0));let e=new CustomEvent("create",{detail:{text:i}});this.dispatchEvent(e)}this.hasAttribute("multiple")?this.selections.has(t)?this._removeSelection(t):this._addSelection(t):(this.open=!1,this._addSelection(t)),this.dispatchEvent(new CustomEvent("change"))}else this.open=!0;break;case"Escape":e.preventDefault(),this._hidePopover()}}_handleSlotchange(){let e=new Set(this.selections),t=!0;for(let i of this.$options.children[0].assignedNodes())e.delete(i),i.onclick=e=>this._handleClickOption.bind(this)(e),t=!1;t?this.setAttribute("empty",""):this.removeAttribute("empty"),e.size>0&&(e.forEach((e=>this._removeSelection(e,!1,!1))),this.selections.size>0&&(this._setButtonText(this.selections),this._updateFormValue())),0!==this.selections.size||this.hasAttribute("multiple")||this.select(0)}_hidePopover(){this._highlight(),"inline"===this.getAttribute("filter")&&(this.$button.style.display="",this.$filter.style.display="none"),this.$filter.value="",this.$popover.hidePopover(),document.removeEventListener("click",this._handleClickDocument)}_highlight(e){this.$highlight&&this.$highlight.removeAttribute("highlighted"),null!=e?(this.$highlight=e,this.$highlight.setAttribute("highlighted","")):this.$highlight=null}_moveOption(e,t){if(!e&&this.getAttribute("multiple"))return;let i=this.getOptions();if(0===i.length)return;let n=this.$highlight;if(null==n){let n=t>0?i[0]:i[i.length-1];return void(e?this._highlight(n):this._addSelection(n))}let o=Array.prototype.indexOf.call(i,n),s=n;for(;i.length>1;)if(o+=t,s=i[o],null!=s){if(n.isSameNode(s))return;if("none"!==s.style.display)break}else o=t>0?-1:i.length;e?this._highlight(s):this._addSelection(s)}_showPopover(){"inline"===this.getAttribute("filter")&&(this.$button.style.display="none",this.$filter.style.display="");let i="bottom-left";e(this)<this.$popover.offsetHeight+20&&(i="top-left"),this._handleClickDocument=t([this.$popoverContent,this.$contButton],(()=>{this.open=!1})),this.$popover.setAttribute("position",this.getAttribute("position")??i),this.$filter.value="",this.showOptions();let n=this.$contButton.getBoundingClientRect().width;this.$options.style.width=`var(--he-select-popover-width, ${n}px)`,this.$popover.style.visibility="hidden",this.$popover.showPopover(),this.$popover.style.visibility="",setTimeout((()=>{this.$filter.focus()}),20)}_setButtonText(e){if(this.hasAttribute("slotted")){this.querySelectorAll('[slot="button"]').forEach((e=>e.remove()));for(const t of e.values()){let e=t.cloneNode();e.innerHTML=t.innerHTML,e.slot="button",this.append(e)}}else{let t=e.values().reduce(((e,t)=>`${e}<span>${t.innerHTML}</span>`),""),i=this.getAttribute("placeholder");""===t&&null!=i&&(t='<span class="placeholder">'+i+"</span>"),this.$button.innerHTML=t}}_updateFormValue(){0!==this.selections.size?this.disabled||this.internals.setFormValue(this.value):this.internals.setFormValue(null)}}customElements.get("he-select")||customElements.define("he-select",n);export{n as HeliumSelect};
