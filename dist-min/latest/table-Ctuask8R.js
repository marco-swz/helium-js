import"./form_dialog-BSGdAGq4.js";import"./check-fWRdq7L8.js";import"./popover-BtSr2gHM.js";import"./dialog-Dpnlt1p2.js";import"./toggle-DGxaHP8n.js";import"./toast-CZgKAYRN.js";import"./button-BRDgEq89.js";import"./input-IRIPAdDX.js";import"./select-DBcffwnj.js";import"./utils-RA_86-hs.js";const e=new CSSStyleSheet;e.replaceSync(':host {\n    --he-table-row-backgroundColor: white;\n    --he-table-column-maxWidth: 300px;\n    --he-table-borderRadius: 4px;\n    --he-table-header-color: black;\n    --he-table-header-backgroundColor: white;\n    --he-table-header-borderBottom: 1px solid black;\n    --he-table-tableLayout: auto;\n    --he-table-width: fit-content;\n    --he-table-row-borderBottomColor: hsl(from var(--he-table-row-backgroundColor) h s calc(l - 20));\n\n    overflow: auto;\n    display: inline-block;\n    scrollbar-gutter: stable both-edges;\n    outline: none;\n}\n\n:host::-webkit-scrollbar {\n    width: 10px !important;\n}\n\n:host::-webkit-scrollbar-thumb {\n    background-color: darkgrey !important;\n    border-radius: 10px !important;\n}\n\ntable {\n    table-layout: var(--he-table-tableLayout);\n    width: var(--he-table-width);\n    border-spacing: 0;\n    border-collapse: separate;\n    border-radius: var(--he-table-borderRadius);\n    font-size: 14px;\n}\n\nthead {\n    position: sticky;\n    top: -1px;\n    z-index: 2;\n}\n\nthead th {\n    background-color: var(--he-table-header-backgroundColor);\n    color: var(--he-table-header-color);\n    font-weight: 500;\n    padding: 5px 0px 5px 15px;\n    text-align: center;\n    vertical-align: middle;\n    text-wrap: nowrap;\n    width: inherit;\n}\n\n:host([filter=below]) {\n    & thead th {\n        padding-bottom: 0;\n        border-bottom: 0;\n    }\n}\n\n:host([column-menu]) {\n    & thead {\n        & tr:first-child th {\n            border-bottom: var(--he-table-header-borderBottom);\n        }\n\n        & th:not([type=check]) {\n            padding: 5px 0 5px 5px;\n\n            & .cont-colname {\n                width: 100%;\n                border-radius: 4px;\n                position: relative;\n\n            }\n\n            & .span-colname {\n                background-color: var(--he-table-header-backgroundColor);\n                cursor: pointer;\n                padding: 7px 10px;\n                border-radius: 4px;\n                width: fit-content;\n                text-align: left;\n                width: 100%;\n                display: inline-flex;\n                width: -moz-available;          /* WebKit-based browsers will ignore this. */\n                width: -webkit-fill-available;  /* Mozilla-based browsers will ignore this. */\n                width: fill-available;\n\n                &::after {\n                    font-family: "Font Awesome 5 Pro";\n                    content: "\\f107";\n                    color: grey;\n                    width: 10px;\n                    height: 15px;\n                    right: 5px;\n                    padding: 0 5px;\n                }\n\n                &:hover {\n                    transition:\n                        background-color 0.2s;\n                    background-color: hsl(from var(--he-table-header-backgroundColor) h s calc(l - 7));\n                }\n            }\n\n            &[filter] .span-colname::after {\n                content: "\\f0b0";\n                background-color: inherit;\n                color: steelblue;\n            }\n\n            &[sort=desc] .span-colname::after {\n                content: "\\f354";\n                background-color: inherit;\n                color: steelblue;\n            }\n\n            &[sort=asc] .span-colname::after {\n                content: "\\f357";\n                background-color: inherit;\n                color: steelblue;\n            }\n\n            &[sort=asc][filter] .span-colname::after {\n                content: "\\f0b0\\f357";\n                background-color: inherit;\n                padding-right: 15px;\n                padding-bottom: 2px;\n                color: steelblue;\n            }\n\n            &[sort=desc][filter] .span-colname::after {\n                content: "\\f0b0\\f354";\n                background-color: inherit;\n                padding-right: 15px;\n                padding-bottom: 2px;\n                color: steelblue;\n            }\n        }\n\n    }\n}\n\n.column-menu div[slot=content] {\n    flex-direction: column;\n    background-color: white;\n    width: 200px;\n    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);\n    gap: 0;\n    border-radius: 4px;\n    padding: 5px 5px;\n    border: 1px solid lightgrey;\n    align-items: flex-start;\n\n    & > div {\n        width: 100%;\n        width: -moz-available;          /* WebKit-based browsers will ignore this. */\n        width: -webkit-fill-available;  /* Mozilla-based browsers will ignore this. */\n        width: fill-available;\n        padding: 7px 10px;\n        border-radius: 4px;\n        cursor: pointer;\n        gap: 5px;\n        justify-content: flex-start;\n\n        &[selected]::after {\n            font-family: "Font Awesome 5 Pro";\n            content: "\\f00c";\n            font-weight: 600;\n            color: steelblue;\n            margin-left: auto;\n        }\n\n        &:hover {\n            transition: background-color 0.2s;\n            background-color: whitesmoke;\n        }\n    }\n\n    & .btn-sort-asc::before {\n        font-family: "Font Awesome 5 Pro";\n        content: "\\f357";\n        font-weight: 600;\n    }\n\n    & .btn-sort-desc::before {\n        font-family: "Font Awesome 5 Pro";\n        content: "\\f354";\n        font-weight: 600;\n    }\n\n    & he-input, & he-select {\n        margin-bottom: 5px;\n        width: 100%;\n    }\n\n    & .btn-apply-filter {\n        background-color: steelblue;\n        color: white;\n        justify-content: center;\n        margin-top: 5px;\n\n        &:hover {\n            transition: background-color 0.2s;\n            background-color: hsl(from steelblue h s calc(l + 7));\n        }\n    }\n\n    .column-filter {\n        display: flex;\n        align-items: center;\n        width: 95%;\n        margin-left: auto;\n        margin-right: auto;\n    }\n\n    .column-filter::before {\n        font-family: "Font Awesome 5 Pro";\n        content: "\\f0b0";\n        padding-left: 5px;\n        font-weight: 600;\n    }\n\n    he-select.column-filter::before {\n        padding-left: 0;\n        padding-right: 7px;\n    }\n}\n\n\nth[filter] .column-filter::before {\n    color: steelblue;\n}\n\n#diag-column {\n    & #form-column {\n        display: flex;\n        gap: 10px;\n        flex-direction: column;\n        width: 250px;\n\n        & label {\n            font-weight: 500;\n            font-size: 16px;\n        }\n\n        & #sel-filter-column, & #inp-filter-column {\n            width: 100%;\n        }\n\n        #toggle-asc, #toggle-desc {\n            width: 40%;\n        }\n    }\n}\n\nthead th:hover .label-sorter {\n    opacity: 0.5;\n}\n\nthead th div {\n    display: flex;\n    align-items: center;\n    gap: 0.7rem;\n    justify-content: space-between;\n}\n\nthead td {\n    background-color: var(--he-table-header-backgroundColor);\n    width: 0;\n}\n\nthead td:has(#check-all) {\n    display: flex;\n    align-items: center;\n    padding: 6px 16px;\n    width: fit-content;\n}\n\nthead td:last-child {\n    border-radius: 0;\n    padding-right: 15px;\n}\n\nthead select {\n    padding: 0px 3px;\n}\n\nthead a {\n    color: rgba(255, 255, 255, 0.5411764706);\n    padding-left: 5px;\n\n}\n\nthead a:hover {\n    color: white;\n}\n\nthead .cont-filter {\n    position: relative;    \n    width: 100%;\n}\n\n.span-colname {\n    font-weight: 600;\n}\n\n:host([filter=below]) {\n    & thead tr:last-child {\n        display: table-row;\n\n        & td {\n            border-bottom: var(--he-table-header-borderBottom);\n        }\n    }\n}\n\nthead tr:first-child th {\n    border-bottom: var(--he-table-header-borderBottom);\n}\n\nthead .inp-filter {\n    margin: 0;\n    padding: 1px 5px;\n    font-size: 12px;\n    font-weight: 500;\n    background-color: transparent;\n    outline: none;\n    border: 0;\n    color: black;\n    -webkit-appearance: none;\n    -moz-appearance: none;\n    appearance: none;\n    text-indent: 1px;\n}\n\ntbody tr:last-child td:first-child {\n    border-bottom-left-radius: var(--he-table-borderRadius);\n}\ntbody tr:last-child td:last-child {\n    border-bottom-right-radius: var(--he-table-borderRadius);\n}\nthead tr:first-child th:first-child {\n    border-top-left-radius: var(--he-table-borderRadius);\n}\nthead tr:first-child th:last-child {\n    border-top-right-radius: var(--he-table-borderRadius);\n}\n\nthead th[type="check"] {\n    padding: 14px 0 6px 0;\n}\n\nthead tr.row-filter {\n    & .inp-filter {\n        background-color: whitesmoke;\n        border-bottom: 1px solid grey;\n        font-size: 14px;\n        padding: 2px 5px;\n        font-weight: 700;\n        width: 100%;\n    }\n\n    & td {\n        overflow: hidden;\n        padding: 2px 7px;\n        padding-top: 0;\n    }\n}\n\ntbody tr {\n    background-color: var(--he-table-row-backgroundColor);\n}\n\ntbody tr:hover {\n    background-color: var(--he-table-row-hover-backgroundColor, hsl(from var(--he-table-row-backgroundColor) h s calc(l - 5)));\n}\n\n/*tbody tr[selected] {*/\n    /*background-color: hsl(from var(--he-table-row-backgroundColor) h s calc(l - 7));*/\n/*}*/\n\ntbody td {\n    text-wrap: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    max-width: var(--he-table-column-maxWidth);\n    padding: 5px 15px;\n    vertical-align: middle;\n    width: 0;\n    border-bottom: 1px solid black;\n    border-bottom-color: var(--he-table-row-borderBottomColor);\n    height: 20px;\n}\n\ntbody td > * {\n    filter: unset;\n}\n\ntbody td:first-child:has(he-check) {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: unset;\n}\n\ntbody tr[selected] td {\n    border-bottom-color: var(--he-table-row-selected-borderBottomColor, var(--he-table-row-borderBottomColor));\n}\n\n\ntbody td xmp {\n    margin: 0;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\ntbody #row-btn-more {\n    background-color: white;\n    color: black;\n    cursor: pointer;\n    text-align: center;\n}\n\ntbody #row-btn-more td:hover {\n    border-color: grey;\n    background-color: whitesmoke;\n}\n\ntbody #row-btn-more td {\n    padding: 0.4rem;\n    border: 1px solid darkgrey;\n    display: table-cell;\n}\n\ntbody #row-empty {\n    &:hover {\n        background-color: white;\n    }\n\n    & td {\n        border-bottom: 0;\n    }\n}\n\n.cont-sorters {\n    display: inline-flex;\n    flex-direction: column;\n    font-size: 0.7rem;\n    gap: 0;\n    cursor: pointer;\n}\n\n.label-sorter {\n    opacity: 0;\n}\n\nthead th div .label-sorter:hover {\n    opacity: 1;\n}\n\nthead th div .label-sorter:has(input:checked) {\n    opacity: 1;\n}\n\n.label-sorter input {\n    display: none;\n}\n\ntable[loading] {\n    pointer-events: none;\n    cursor: no-drop;\n}\n\ntable[loading] tbody {\n    position: relative;\n}\n\ntable[loading] tbody::after {\n    content: "";\n    position: absolute;\n    height: 100%;\n    width: 100%;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    margin: auto;\n    background: linear-gradient(-90deg, #dbd8d8 0%, #fcfcfc 50%, #dbd8d8 100%);\n    background-size: 400% 400%;\n    animation: pulse 1.2s ease-in-out infinite;\n}\n\n@keyframes pulse {\n    0% {\n        background-position: 0% 0%\n    }\n    100% {\n        background-position: -135% 0%\n    }\n}\n\nhe-form-dialog {\n    --he-form-dialog-width: 350px;\n}\n');class t extends HTMLElement{static formAssociated=!0;static observedAttributes=["endpoint","pagination"];endpoint;$checkAll;$form;$body;$menuOpen;$diagEdit;$diagColumn;dataOld;editRequestType;idsEdit=[];nextRowId=0;pagination;disableRequest=!1;offset=0;remap={};options={};internals;rowColors={};rowStyles={};cellStyles={};constructor(){super();let t=this.attachShadow({mode:"open"});this.internals=this.attachInternals(),t.adoptedStyleSheets=[e]}set loading(e){e?this.$body.parentElement.setAttribute("loading",!0):this.$body.parentElement.removeAttribute("loading")}get loading(){return null!=this.$body.parentElement.getAttribute("loading")}get value(){return this.getCheckedData()}get validationMessage(){return this.internals.validationMessage}get validity(){return this.internals.validity}attributeChangedCallback(e,t,n){switch(e){case"endpoint":this.endpoint=n;break;case"pagination":this.pagination=Number(n)}}checkValidity(){return this.internals.checkValidity()}connectedCallback(){this._renderTable();for(let e of this.$form.querySelectorAll(".cont-filter")){let t=e.querySelector(".span-colname");e.querySelector(".inp-filter").style.minWidth=t.offsetWidth+"px"}this._requestRows(this.replaceBody),this._updateExternElements([]),this.getAttribute("submit-all")&&this.internals.setFormValue(JSON.stringify(this.getTableData())),this.$form.addEventListener("input",(e=>e.stopPropagation()))}deleteChecked(e=!0){let t=this.shadowRoot.querySelectorAll(".check-row:state(checked)"),n={data:[]};for(let e of t){let t=e.closest("tr"),r=this._getRowData(t);n.data.push(r)}let r=n.data.length;if(0===r)return void window.alert("Keine Zeilen ausgewählt.");const o=r>1?`werden ${r} Zeilen`:"wird 1 Zeile";if(!e||window.confirm(`Es ${o} gelöscht.\nSind Sie sicher?`))if(null==this.endpoint){for(const e of t)e.parentElement.parentElement.remove();this.getAttribute("submit-all")&&this.internals.setFormValue(JSON.stringify(this.getTableData()))}else fetch(this.endpoint,{method:"DELETE",body:JSON.stringify(n)}).then((e=>e.json())).then((e=>{e.forEach(((e,n)=>{e||t[n].closest("tr").remove()}))})).catch((e=>{const t=new CustomEvent("he-toast-error",{detail:e});this.dispatchEvent(t)}))}filterColumn(e,t,n=!0){let r=this._columnFromName(e);return this._filterColumn(r,t,n),this}formEditBeforeSubmitCallback(e){if(null!=this.endpoint)e.fetchArgs.body={data:[JSON.parse(e.fetchArgs.body)]},null!=this.dataOld&&(e.fetchArgs.body.old=[this.dataOld]),e.fetchArgs.method=this.editRequestType,e.fetchArgs.headers={Accept:"application/json","Content-Type":"application/json"},e.fetchArgs.body=JSON.stringify(e.fetchArgs.body);else{switch(this.editRequestType){case"POST":this._appendRows([this.$diagEdit.getValues()]);break;case"PATCH":this.replaceRowData(this.idsEdit[0],this.$diagEdit.getValues())}this.$diagEdit.close()}}formEditAfterSubmitCallback(e){e.response.json().then((e=>{switch(this.editRequestType){case"POST":this._requestRows(this.replaceBody);break;case"PATCH":e.forEach(((e,t)=>{const n=this.idsEdit[t];this.replaceRowData(n,e)}))}this.$diagEdit.close()}))}getColumnNames(){const e=this._getColumns(!0),t={};for(const n of e){const e=n.getAttribute("column");null!=e&&(t[e]=n.querySelector(".span-colname").innerText)}return t}getCheckedData(e=!1){let t=this.shadowRoot.querySelectorAll(".check-row:state(checked)"),n=[];for(let r of t){let t=r.closest("tr"),o=this._getRowData(t,e);n.push(o)}return n}getFormData(){return new FormData(this.$form)}getTableData(e=!1){return this._getTableData(e)}mergeData(e,t,n=!1){Array.isArray(e)||(e=[e]);let r={};for(const n of this.$body.rows){if("row-empty"===n.id){t.length>0&&n.remove();continue}const o=this._getRowData(n);r[e.map((e=>o[e])).join("-")]=n}const o=this._getColumns(!0);for(const n of t){const t=e.map((e=>n[e])).join("-");let i=r[t];if(delete r[t],null!=i){i.style.removeProperty("--he-table-row-backgroundColor");for(const e of o){const t=e.getAttribute("column");if(!(t in n))continue;const r=n[t]??"";let o=i.cells[e.cellIndex];o.setAttribute("data",r);const l=this._renderText(e,r);o.innerHTML=l,o.title=l,this._applyRowStyles(i,t,r)}this._applyRowFilter(i,o)}else i=this._renderRow(n),this.$body.append(i),this._applyRowFilter(i,o)}if(n)for(const e of Object.values(r))e.remove()}refresh(){this._requestRows(this.replaceBody)}replaceBody(e){this.$body.innerHTML="",this.offset=0,this._updateExternElements([]),this.$checkAll&&(this.$checkAll.checked=!1,this.$checkAll.indeterminate=!1),0===e.length&&this.$body.append(this._renderRowEmpty());let t=!1;null!=this.pagination&&e.length>this.pagination&&(e.pop(),t=!0);for(let t of e)this.$body.append(this._renderRow(t));t&&this.$body.append(this._renderButtonMore()),this.getAttribute("submit-all")&&this.internals.setFormValue(JSON.stringify(this.getTableData()))}reset(){this.$body.querySelectorAll(".check-row").forEach((e=>e.checked=!1)),null!=this.$checkAll&&(this.$checkAll.checked=!1,this.$checkAll.indeterminate=!1)}replaceRowData(e,t){let n=this.$body.querySelector("#"+e);if(null==n)throw new Error("No row found with the row ID "+e);let r=this._getColumns(!0);for(let e=0;e<r.length;++e){const o=r[e],i=t[o.getAttribute("column")];if(null==i)continue;let l=n.children[e+1];l.setAttribute("data",i),l.innerHTML=this._renderText(o,i)}this.getAttribute("submit-all")&&this.internals.setFormValue(JSON.stringify(this.getTableData()))}reportValidity(){return this.internals.reportValidity()}selectRows(e){Array.isArray(e)||(e=[e]);for(const t of e)for(let e of this.$body.children){const n=this._getRowData(e);let r=!0;for(const[e,o]of Object.entries(t))if(n[e]!==o){r=!1;break}r&&(e.querySelector(".check-row")??e).click()}}setRowData(e,t){let n={};for(const e of this._getColumns(!0))n[colName]=e;for(const r of this.$body.rows){let o=!0;for(const[t,i]of Object.entries(e)){const e=n[t];if(null==idx)throw new Error(`No column with name '${t}'!`);if(i!==r.cells[e.cellIndex].getAttribute("data")){o=!1;break}}if(o)for(const[e,o]of Object.entries(t)){const t=n[e],i=r.cells[t.cellIndex];i.setAttribute("data",o),i.innerHTML=this._renderText(t,o)}}return this}showDialogEdit(){this.$diagEdit.reset();let e=this.shadowRoot.querySelector(".check-row:state(checked)");if(null==e)throw new Error("No row selected");let t=e.parentElement.parentElement;this._showDialogEdit(t)}showDialogDuplicate(){this.$diagEdit.reset();let e=this.shadowRoot.querySelector(".check-row:state(checked)");if(null==e)throw new Error("No row selected");let t=e.parentElement.parentElement,n=this._getRowData(t,!1);this.$diagEdit.setValues(n),this.editRequestType="POST",this.$diagEdit.setAttribute("title-text","Duplizieren"),this.$diagEdit.showModal()}showDialogNew(){this.$diagEdit.reset(),this.editRequestType="POST",this.$diagEdit.setAttribute("title-text","Erstellen"),this.$diagEdit.showModal()}sortColumn(e,t){let n=this._columnFromName(e);return this._sortColumn(n,t),this}_appendRows(e){null!=this.pagination&&e.length>this.pagination&&e.pop();let t=null;"row-btn-more"===this.$body.lastChild.id&&(t=this.$body.lastChild,this.$body.removeChild(t));for(let t of e)this.$body.append(this._renderRow(t));null!=t&&e.length===this.pagination&&this.$body.append(t)}_applyCellStyles(e,t,n){let r=this.cellStyles[t];if(null===r)return;if(r=r[n],null===r)return void(e.style.cssText="");let o=r[n];e.style.cssText=o||""}_applyRowStyles(e,t,n){let r=this.rowStyles[t];if(r){let t=r[n];e.style.cssText=t||""}let o=this.rowColors[t];if(o){let t=o[n];t&&e.style.setProperty("--he-table-row-backgroundColor",t)}}_applyFilters(e){let t={};for(const n of this.$body.children){const r=this._applyRowFilter(n,e);null!=r&&(t[n.id]=r)}this._updateCheckAll(Object.values(t)),this._updateExternElements(Object.values(t))}_applyRowFilter(e,t){if("row-empty"===e.id)return;const n=e.querySelector("he-check");let r=e.getAttribute("mask")??0;for(const n of t){const t=null!=n.getAttribute("exact-filter");let o=n.getAttribute("filter")??"";const i=e.children[n.cellIndex].getAttribute("data");o=o.toLowerCase();(t?i===o:i.toLowerCase().includes(o))?r&=~(1<<n.cellIndex):r|=1<<n.cellIndex}return e.setAttribute("mask",r),r>0?(e.style.visibility="collapse",n&&(n.checked=!1)):e.style.visibility=null,n&&n.checked?n:null}_closeColumnMenu(){this.$menuOpen&&(this.$menuOpen.open=!1,this.$menuOpen=null)}_columnFromName(e){let t=this._getColumns();for(let n=0;n<t.length;++n){let r=t[n];if(r.getAttribute("column")===e)return r}throw new Error(`No column found with name ${e}`)}_filterColumn(e,t,n=!0){const r=e.getAttribute("column");let o=this.$form.querySelector(`.inp-filter[name="${r}"]`);null!=o&&(o.value=t);let i=e.getAttribute("exact-filter");n?e.setAttribute("exact-filter",""):e.removeAttribute("exact-filter"),""===t?e.removeAttribute("filter"):e.setAttribute("filter",t),null==this.endpoint?(this._applyFilters([e]),i?e.setAttribute("exact-filter",""):e.removeAttribute("exact-filter")):this._requestRows(this.replaceBody)}_getColumns(e=!1){return e?this.shadowRoot.querySelectorAll("th[column]"):this.shadowRoot.querySelectorAll("th")}_getRowData(e,t=!1){if("row-empty"===e.id)throw new Error("Attempt to get data of empty row!");let n={},r=this._getColumns(!0);for(let o=0;o<r.length;++o){let i=r[o];if(t&&["hidden","check"].includes(i.getAttribute("type")))continue;let l=e.children[i.cellIndex];n[i.getAttribute("column")]=t?l.innerText:l.getAttribute("data")}return n}_getTableData(e=!1){return Array.from(this.$body.children).map((t=>this._getRowData(t,e)))}_handleChangeFilter(e){this.offset=0;const t=e.currentTarget.value,n=e.currentTarget.closest("td").cellIndex,r=this._getColumns(!1)[n];this._filterColumn(r,t)}_handleCheckAll(){this.$checkAll.indeterminate=!1;const e=this.$body.querySelectorAll(".check-row");if(this.$checkAll.checked){for(const t of e)t.checked=!0;this._updateExternElements(e)}else{for(const t of e)t.checked=!1;this._updateExternElements([])}}_handleClickApplyColumn(e,t){e.preventDefault();const n=t.querySelector(".column-filter").value;this.disableRequest=!0,this._filterColumn(t,n),this.disableRequest=!1;const r=t.querySelector(".btn-sort-asc").hasAttribute("selected"),o=t.querySelector(".btn-sort-desc").hasAttribute("selected");let i=null;r?i="asc":o&&(i="desc"),this._sortColumn(t,i),t.querySelector(".column-menu").removeAttribute("open")}_handleClickColumn(e,t){switch(e.stopPropagation(),this._closeColumnMenu(),t.getAttribute("sort")){case"desc":t.querySelector(".btn-sort-desc").setAttribute("selected",""),t.querySelector(".btn-sort-asc").removeAttribute("selected");break;case"asc":t.querySelector(".btn-sort-asc").setAttribute("selected",""),t.querySelector(".btn-sort-desc").removeAttribute("selected");break;default:t.querySelector(".btn-sort-desc").removeAttribute("selected"),t.querySelector(".btn-sort-asc").removeAttribute("selected")}let n=t.querySelector(".column-menu");n.open=!0;let r=t.querySelector(".column-filter");r.value=t.getAttribute("filter")??"","HE-INPUT"===r.nodeName&&setTimeout((()=>{r.select()}),10),this.$menuOpen=n}_handleClickPagination(){this.offset+=this.pagination??0,this._requestRows(this._appendRows)}_handleClickRow(e){const t=e.currentTarget;let n=null;if(this.$checkAll){const r="false"!==this.$checkAll.parentElement.getAttribute("multiple");if(n=this.$body.querySelectorAll(".check-row:state(checked)"),!r||!e.target.classList.contains("check-row")){for(let e of n)e.checked=!1;t.children[0].children[0].checked=!0}n=this.$body.querySelectorAll(".check-row:state(checked)"),this._updateCheckAll(n)}const r=this.$body.querySelector("tr[selected]");r&&r.removeAttribute("selected"),t.setAttribute("selected",""),this._updateExternElements(n??[t])}_handleClickSort(e,t){let n=e.currentTarget.closest("th"),r=t?"desc":"asc";this._sortColumn(n,r)}_handleClickWindow(){this._closeColumnMenu()}_renderButtonMore(){let e=document.createElement("tr");e.id="row-btn-more";let t=document.createElement("td");return t.colSpan="100",t.title="Mehr anzeigen",t.innerHTML="Mehr anzeigen",t.onclick=()=>this._handleClickPagination(),e.append(t),e}_renderDialogEdit(){let e=[];for(let t of this._getColumns(!0)){const n=t.getAttribute("type"),r=t.getAttribute("column");let o="true"===t.getAttribute("required"),i="hidden"===n;t.getAttribute("no-edit")&&(i=!0,o=!1);const l=this.options[r];let s={};if(null!=l){const e=this.remap[r];for(const t of l){if(s[t]=t,null==e)continue;const n=e[t];null!=n&&(s[t]=n)}}let a=t.getAttribute("type"),d=null;"datetime"===a&&(a="datetime-local",d={step:"1"}),e.push({name:t.getAttribute("column"),required:o,label:t.querySelector(".span-colname").innerHTML,placeholder:t.getAttribute("default"),pattern:t.getAttribute("pattern"),hidden:i,attributes:d,options:s,type:a})}let t=document.createElement("he-form-dialog");return t.renderRows(e),t.setAttribute("endpoint",this.endpoint??""),t.onsubmit=e=>this.formEditBeforeSubmitCallback.bind(this)(e),t.onresponse=e=>this.formEditAfterSubmitCallback.bind(this)(e),t}_renderRow(e){let t=document.createElement("tr");t.id="row-"+this.nextRowId++,t.onclick=e=>this._handleClickRow.bind(this)(e);for(let n of this._getColumns()){const r=n.getAttribute("column");let o=e[r]??"",i=o,l=document.createElement("td");switch(n.getAttribute("type")){case"check":let s=document.createElement("he-check");s.name="rows[]",s.value=e.id??"",s.classList.add("check-row"),l.append(s);break;case"edit":l.addEventListener("click",(()=>this._showDialogEdit.bind(this)(t))),l.innerHTML="E";break;case"callback":l.setAttribute("data",o),l.innerHTML=window[n.getAttribute("onrender")](e,r)??"";break;case"hidden":l.style.display="none";default:l.setAttribute("data",o),l.innerHTML=this._renderText(n,i),l.title=o,this._applyCellStyles(l,r,o),this._applyRowStyles(t,r,o)}t.append(l)}return t}_renderRowEmpty(){let e=document.createElement("tr");e.id="row-empty";for(let t=0;t<this._getColumns().length;++t){let t=document.createElement("td");e.append(t)}return e}_requestRows(e){if(null==this.endpoint||this.disableRequest)return;this.loading=!0;let t=new URLSearchParams,n=!1;for(const e of this._getColumns(!0)){const r=e.getAttribute("filter"),o=e.getAttribute("column");null!=r&&""!==r&&t.append(o,r);const i=e.getAttribute("sort");null!=i&&(t.append("sort",o+"-"+i),n=!0)}if(this.getAttribute("require-filter")&&!n)return this.loading=!1,void e.bind(this)([]);null!=this.pagination&&(t.append("offset",this.offset),t.append("count",this.pagination+1)),fetch(this.endpoint+"/?"+t.toString(),{method:"GET"}).then((e=>e.json())).then((t=>{e.bind(this)(t)})).catch((e=>{console.error(e)})).finally((()=>this.loading=!1))}_renderSorters(e,t){let n=document.createElement("input");n.type="radio",n.name="sort",n.value=e+"-asc",n.id=e+"-asc",n.onclick=e=>this._handleClickSort.bind(this)(e,!1),"asc"===t&&(n.checked=!0);let r=document.createElement("label");r.for=e+"asc",r.innerHTML="▲",r.classList.add("label-sorter"),r.append(n);let o=document.createElement("input");o.type="radio",o.name="sort",o.value=e+"-desc",o.id=e+"-desc",o.onclick=e=>this._handleClickSort.bind(this)(e,!0),"desc"===t&&(o.checked=!0);let i=document.createElement("label");i.for=e+"desc",i.classList.add("label-sorter"),i.innerHTML="▼",i.append(o);let l=document.createElement("div");return l.classList.add("cont-sorters"),l.append(r),l.append(i),null==this.getAttribute("sorter")&&(l.style.display="none"),l}_renderText(e,t){let n=t;if(""!==(t??""))switch(e.getAttribute("type")){case"date":n=t.split("-").reverse().join(".");break;case"datetime":t=t.replace("T"," ");const[e,r]=t.split(" ");n=e.split("-").reverse().join(".")+" "+r}const r=this.remap[e.getAttribute("column")];if(r){const e=r[t];e&&(n=e)}return n??""}_renderFilter(e,t){let n=null;if(this.options[t]){n=document.createElement("select");let r=document.createElement("option");r.value="",n.append(r);for(const r of this.options[t]){const t=this._renderText(e,r);let o=document.createElement("option");o.innerHTML=t,o.value=r,n.append(o)}}else n=document.createElement("input"),n.type=e.getAttribute("filter-type")??"text",n.autocomplete="efase",n.placeholder=" ";return n.onchange=e=>this._handleChangeFilter(e),n.value=e.getAttribute("filter")??"",n.id="filter-"+t,n.name=t,n.classList.add("inp-filter"),n}_renderHead(e){let t=document.createElement("tr");t.classList.add("row-filter");let n=document.createElement("tr");n.classList.add("row-colName");const r=null!=this.getAttribute("column-menu"),o=this.getAttribute("filter");for(let i of e){let e=i.getAttribute("column");null==e&&(e=i.innerText,["check","edit","duplicate","delete"].includes(i.getAttribute("type"))||i.setAttribute("column",e));try{this.options[e]=JSON.parse(i.getAttribute("options"),((e,t,n)=>"number"==typeof t?n.source:t))}catch(e){throw new Error("The provided options are not valid JSON!")}try{this.remap[e]=JSON.parse(i.getAttribute("remap"))}catch(e){throw new Error("The provided remap is not valid JSON!")}try{this.rowColors[e]=JSON.parse(i.getAttribute("row-color"))}catch(e){throw new Error("The provided row-color is not valid JSON!")}try{this.rowStyles[e]=JSON.parse(i.getAttribute("row-style"))}catch(e){throw new Error("The provided row-style is not valid JSON!")}try{this.cellStyles[e]=JSON.parse(i.getAttribute("cell-style"))}catch(e){throw new Error("The provided cell-style is not valid JSON!")}let l=document.createElement("td");t.append(l);"hidden"===i.getAttribute("type")&&(i.style.display="none",l.style.display="none");const s=i.getAttribute("type");switch(s){case"check":this.$checkAll=document.createElement("he-check"),this.$checkAll.id="check-all",this.$checkAll.onchange=e=>this._handleCheckAll.bind(this)(e),i.setAttribute("type","check"),"below"===o?l.append(this.$checkAll):i.append(this.$checkAll),n.append(i);continue;case"edit":case"delete":case"duplicate":let e=document.createElement("th");e.setAttribute("type",s),n.append(e);continue;case"callback":let t=document.createElement("span");t.innerHTML=i.innerHTML.trim(),t.classList.add("span-colname"),i.innerHTML="",i.append(t),n.append(i);continue}let a=document.createElement("div"),d=document.createElement("span");if(d.innerHTML=i.innerHTML.trim(),i.innerHTML="",d.classList.add("span-colname"),r)a.append(d),a.classList.add("cont-colname"),a.append(this._renderColumnMenu(i)),d.addEventListener("click",(e=>this._handleClickColumn.bind(this)(e,i))),window.addEventListener("click",(()=>this._handleClickWindow.bind(this)()));else if("below"===o){let t=this._renderFilter(i,e);a.append(d),l.append(t);const n=i.getAttribute("sort");let r=this._renderSorters(e,n);i.setAttribute("column",e),a.append(r)}else a.append(d),d.style.position="unset";i.append(a),n.append(i)}let i=document.createElement("thead");return i.append(n),r||i.append(t),i}_renderColumnMenu(e){const t=e.getAttribute("column");let n=document.createElement("he-popover");n.classList.add("column-menu"),n.addEventListener("click",(e=>e.stopPropagation())),n.$anchor=e;let r=document.createElement("div");r.slot="content",n.append(r);if(null!=e.getAttribute("description")){let e=document.createElement("div");e.classList.add("btn-description"),e.innerHTML="Beschreibung",r.append(e)}const o=e.getAttribute("filter");let i=this.remap[t]??{},l=this.options[t];if(null!=l){l=[...l],l.sort((function(e,t){return e.localeCompare(t)})),l.unshift("");let e=document.createElement("he-select");e.setAttribute("filter","inline"),e.classList.add("column-filter"),e.name="filter",e.replaceOptions(l,i),e.value=o??"",r.append(e)}else{let e=document.createElement("he-input");e.setAttribute("filter","true"),e.classList.add("column-filter"),e.name="filter",e.value=o??"",e.select(),r.append(e)}let s=document.createElement("div");s.classList.add("btn-sort-asc"),s.innerHTML="Aufsteigend sortieren",r.append(s);let a=document.createElement("div");a.classList.add("btn-sort-desc"),a.innerHTML="Absteigend sortieren",r.append(a),s.onclick=()=>{s.hasAttribute("selected")?s.removeAttribute("selected"):s.setAttribute("selected",""),a.removeAttribute("selected")},a.onclick=()=>{a.hasAttribute("selected")?a.removeAttribute("selected"):a.setAttribute("selected",""),s.removeAttribute("selected")};let d=document.createElement("div");return d.classList.add("btn-apply-filter"),d.innerHTML="Anwenden",d.onclick=t=>this._handleClickApplyColumn.bind(this)(t,e),r.append(d),r.addEventListener("keyup",(e=>{"Enter"===e.key&&d.click()})),n}_renderTable(){const e=this.shadowRoot,t=this.querySelectorAll("th");this.id=""==this.id?"he-table-"+Math.floor(10000000001*Math.random()):this.id;let n=document.createElement("table");this.$form=document.createElement("form"),this.$form.id="form-tbl",this.$form.append(n),e.append(this.$form);const r=this._renderHead(t);n.append(r),this.$body=document.createElement("tbody");const o=this.querySelectorAll("tr:has(td)");if(0===o.length)this.$body.append(this._renderRowEmpty());else for(const e of o){let n={},r=0;for(let o=0;o<t.length;++o){const i=t[o],l=i.getAttribute("column");if(!l||["check","edit","duplicate","delete"].includes(i.getAttribute("type")))continue;const s=e.children[r],a=s.getAttribute("data")??s.innerText;n[l]=a,++r}let o=this._renderRow(n);this.$body.append(o)}n.append(this.$body),this.$diagEdit=this._renderDialogEdit(),e.append(this.$diagEdit),this.innerHTML=""}_showDialogEdit(e){let t=this._getRowData(e,!1);this.$diagEdit.setValues(t),this.dataOld=t,this.idsEdit=[e.id],this.editRequestType="PATCH",this.$diagEdit.setAttribute("title-text","Bearbeiten"),this.$diagEdit.showModal()}_sortColumn(e,t){if("desc"!==t&&"asc"!==t&&null!=t)throw new Error(`Invalid sort direction: ${t}`);if(null==t)e.removeAttribute("sort");else for(let e of this._getColumns(!0))e.removeAttribute("sort");if(null!=t&&e.setAttribute("sort",t),"below"===this.getAttribute("filter")){let n=this.$form.querySelector("input[name=sort]:checked");if(null!=n&&(n.checked=!1),null!=t){const n=e.getAttribute("column");e.querySelector(`#${n}-${t}`).checked=!0}}if(this.endpoint)return void this._requestRows(this.replaceBody);const n=Array.prototype.indexOf.call(e.parentElement.children,e);let r=[];for(const e of this.$body.children)r.push([e.children[n].getAttribute("data"),e]);let o="desc"===t?Array.from(r).sort(((e,t)=>t[0].localeCompare(e[0]))):Array.from(r).sort(((e,t)=>e[0].localeCompare(t[0])));for(const e of o)this.$body.append(e[1])}_updateCheckAll(e){this.$checkAll&&(0===e.length?(this.$checkAll.checked=!1,this.$checkAll.indeterminate=!1):e.length<this.$body.children.length?(this.$checkAll.checked=!0,this.$checkAll.indeterminate=!0):(this.$checkAll.indeterminate=!1,this.$checkAll.checked=!0))}_updateExternElements(e){this.getAttribute("name")&&null==this.getAttribute("submit-all")&&this.internals.setFormValue(JSON.stringify(this.value));const t=new CustomEvent("input",{detail:{numRows:e.length}});this.dispatchEvent(t)}}customElements.get("he-table")||customElements.define("he-table",t);export{t as HeliumTable};
